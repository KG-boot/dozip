<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="partEstimate">
    <!--사업자번호 기준으로 견적 테이블 불러오기 -->
    <select id="est_list" resultType="EstimateVO">
        select * from estimateT where est_check != '대기중' and est_check != '수락' order by EST_NUM desc
    </select>

    <!--계약 요청중인 입찰테이블 -->
    <select id="est_list2" resultType="BidVO">
        select * from bidT where bid_state='계약요청'
    </select>

    <!--계약서에 입력할 정보 불러오기 -->
    <select id="write_contract" resultType="EstimateVO">
        select * from estimateT where est_num=#{est_num} and est_check='계약요청'
    </select>

    <!--계약서 정보 insert -->
    <select id="contract_in" resultType="int">
        insert into CONTRACTT values(('C'||to_char(sysdate, 'yyyymmdd')||'-'||contractT_no_seq.nextval), #{est_num}, #{mem_id}, #{businessNum},#{cont_title},#{cont_location},TO_NUMBER(#{cont_area}),TO_DATE(#{cont_start},'YYYY-MM-DD'),
                                     TO_DATE(#{cont_end},'YYYY-MM-DD'),TO_NUMBER(#{cont_total}),TO_NUMBER(#{cont_cost1}),TO_DATE(#{cont_date1},'YYYY-MM-DD'),TO_NUMBER(#{cont_cost2}),TO_DATE(#{cont_date2},'YYYY-MM-DD'),TO_NUMBER(#{cont_cost3}),
                                     TO_DATE(#{cont_date3},'YYYY-MM-DD'),TO_DATE(#{cont_date},'YYYY-MM-DD'),#{customer_name},#{customer_addr},#{customer_number},#{customer_tel},#{partners_name},#{partners_addr},#{partners_tel})
    </select>
    <!--입찰정보 불러오기 -->
    <select id="get_bid" resultType="BidVO">
        select * from bidT where est_num=#{est_num}
    </select>
    <!--견적정보 불러오기 -->
    <select id="get_est" resultType="EstimateVO">
        select * from ESTIMATET where est_num=#{est_num}
    </select>
    <!--견적서 계약서 '작성완료' 로바꾸기 -->
    <select id="update_est">
        update ESTIMATET set EST_CHECK='작성완료' where EST_NUM =#{est_num}
    </select>
    <!--계약서 테이블 불러오기 -->
    <select id="all_contract" resultType="ContractVO">

        select cont_no, est_num, cont_location, cont_total, cont_start, cont_end, cont_date, TRUNC(SYSDATE)-CONT_DATE as dateCheck from contractT where BUSINESSNUM=#{businessNum} order by cont_no desc

    </select>
    <!--내공사 내역에서 사용할 계약 리스트 -->
    <select id="interior_estimate" resultType="ContractVO">
        select c.*, p.PAY_STATE from CONTRACTT c, PAYT p where c.BUSINESSNUM=#{businessNum} and p.CONT_NO=c.CONT_NO and PAY_STATE!='계약금요청'
    </select>
    <!--내공사 내역에서 계약서 조회 -->
    <select id="show_contract" resultType="ContractVO">
        select * from contractT where cont_no=#{cont_no}
    </select>

    <!-- 계약금 요청상태인 payT 조회 -->
    <select id="get_paystate" resultType="PayVO">
        select cont_no, pay_state from payT where businessNum=#{businessNum} and pay_state = '계약금요청'
    </select>
</mapper>




